<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CBT HOTS Pro - 100 Soal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb; /* Blue 600 */
            --primary-dark: #1e40af;
            --accent: #f59e0b; /* Amber 500 */
            --danger: #dc2626; /* Red 600 */
            --success: #16a34a; /* Green 600 */
            --bg: #f8fafc;
            --text: #0f172a;
            --sidebar-width: 340px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); 
            margin: 0; height: 100vh; display: flex; overflow: hidden; user-select: none; 
        }

        /* --- LOBBY SCREEN --- */
        #lobby {
            position: fixed; inset: 0; z-index: 2000;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }
        .lobby-card {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); width: 100%; max-width: 450px;
            text-align: center; border: 1px solid #e2e8f0;
        }
        .input-field {
            width: 100%; padding: 14px; margin-top: 10px; border: 2px solid #e2e8f0;
            border-radius: 10px; font-size: 1rem; outline: none; transition: 0.3s;
        }
        .input-field:focus { border-color: var(--primary); }
        .btn-start {
            width: 100%; padding: 16px; background: var(--primary); color: white;
            border: none; border-radius: 50px; font-weight: 700; font-size: 1.1rem;
            cursor: pointer; margin-top: 25px; transition: transform 0.2s;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }
        .btn-start:active { transform: scale(0.98); }

        /* --- MAIN APP LAYOUT --- */
        #app { display: none; width: 100%; height: 100%; }
        
        /* Area Kiri (Header + Soal + Footer) */
        .main-col { flex: 1; display: flex; flex-direction: column; position: relative; height: 100%; }
        
        .header {
            height: 70px; background: white; border-bottom: 1px solid #e2e8f0;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
            z-index: 10;
        }
        .timer-box {
            background: #1e293b; color: #fbbf24; padding: 8px 16px; border-radius: 8px;
            font-family: monospace; font-size: 1.25rem; font-weight: 700; letter-spacing: 1px;
        }

        .content-scroll { flex: 1; overflow-y: auto; padding: 30px; background: #f1f5f9; }
        
        /* Kartu Soal */
        .q-card {
            background: white; border-radius: 16px; padding: 40px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
            max-width: 900px; margin: 0 auto;
        }
        .q-meta {
            font-size: 0.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            color: #64748b; margin-bottom: 20px; display: flex; justify-content: space-between;
        }
        .q-text {
            font-family: 'Merriweather', serif; font-size: 1.2rem; line-height: 1.8;
            color: #334155; margin-bottom: 35px; text-align: justify;
        }
        
        /* Opsi Jawaban */
        .opt-list { display: grid; gap: 15px; grid-template-columns: 1fr 1fr; }
        .opt-btn {
            background: white; border: 2px solid #e2e8f0; padding: 15px 20px;
            border-radius: 12px; cursor: pointer; display: flex; align-items: center;
            transition: all 0.2s;
        }
        .opt-btn:hover { border-color: #94a3b8; background: #f8fafc; }
        .opt-btn.selected { border-color: var(--primary); background: #eff6ff; }
        
        .opt-idx {
            width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0;
            color: #64748b; font-weight: bold; display: flex; align-items: center;
            justify-content: center; margin-right: 15px; flex-shrink: 0;
        }
        .opt-btn.selected .opt-idx { background: var(--primary); color: white; }

        /* Footer Navigasi */
        .footer {
            height: 80px; background: white; border-top: 1px solid #e2e8f0;
            display: flex; align-items: center; justify-content: space-between; padding: 0 30px;
        }
        .btn-nav {
            padding: 12px 24px; border-radius: 8px; font-weight: 700; border: none; cursor: pointer;
            transition: 0.2s; font-size: 0.95rem;
        }
        .btn-prev { background: #e2e8f0; color: #475569; }
        .btn-next { background: var(--primary); color: white; }
        .btn-ragu { background: var(--accent); color: white; margin: 0 10px; }
        .btn-ragu.active { box-shadow: inset 0 0 0 3px #92400e; }

        /* Area Kanan (Sidebar Navigasi) */
        .sidebar {
            width: var(--sidebar-width); background: white; border-left: 1px solid #e2e8f0;
            display: flex; flex-direction: column; height: 100%; z-index: 20;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sb-header { padding: 20px; border-bottom: 1px solid #e2e8f0; font-weight: 800; background: #f8fafc; }
        .grid-wrapper { flex: 1; overflow-y: auto; padding: 15px; }
        .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .nav-item {
            aspect-ratio: 1; border: 1px solid #cbd5e1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.9rem; cursor: pointer; background: white; position: relative;
        }
        /* Status Warna Navigasi */
        .nav-item:hover { background: #f1f5f9; }
        .nav-item.active { border: 2px solid var(--primary); }
        .nav-item.done { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-item.ragu { background: var(--accent); color: white; border-color: var(--accent); }

        .btn-submit {
            width: 100%; padding: 15px; background: var(--danger); color: white;
            border: none; font-weight: 800; cursor: pointer;
        }

        /* --- RESPONSIVE --- */
        .mobile-toggle { display: none; background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        @media (max-width: 1024px) {
            .opt-list { grid-template-columns: 1fr; }
            .sidebar { position: fixed; right: 0; top: 0; bottom: 0; transform: translateX(100%); }
            .sidebar.open { transform: translateX(0); box-shadow: -5px 0 20px rgba(0,0,0,0.15); }
            .mobile-toggle { display: block; }
            .q-card { padding: 25px; }
        }

        /* --- MATH STYLING --- */
        .mixed { font-family: 'Times New Roman', serif; font-size: 1.15em; white-space: nowrap; }
        .frac { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin-left: 2px; font-size: 0.8em; }
        .top { border-bottom: 1px solid currentColor; padding: 0 2px; display: block; }
        .bot { padding: 0 2px; display: block; }

        /* --- MODALS --- */
        #modal-res, #warning {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000;
            display: none; align-items: center; justify-content: center; flex-direction: column; color: white; text-align: center;
        }
        .res-box { background: white; color: #1e293b; padding: 40px; border-radius: 20px; width: 90%; max-width: 450px; }
        .score-big { font-size: 5rem; font-weight: 900; color: var(--primary); margin: 10px 0; line-height: 1; }
        .btn-wa { background: #25d366; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: 700; margin-top: 20px; cursor: pointer; }

    </style>
</head>
<body>

    <div id="lobby">
        <div class="lobby-card">
            <h1 style="color:var(--primary); margin-bottom:5px;">UJIAN CBT PRO</h1>
            <p style="color:#64748b; font-size:0.9rem;">100 Soal Unik â€¢ 120 Menit â€¢ HOTS</p>
            <div style="text-align:left; margin-top:25px;">
                <label style="font-size:0.85rem; font-weight:700;">Nama Lengkap</label>
                <input type="text" id="nama" class="input-field" placeholder="Masukkan nama...">
                <label style="font-size:0.85rem; font-weight:700; margin-top:15px; display:block;">Kelas</label>
                <input type="text" id="kelas" class="input-field" placeholder="Contoh: 9A">
            </div>
            <button class="btn-start" onclick="startExam()">MULAI MENGERJAKAN</button>
        </div>
    </div>

    <div id="app">
        <div class="main-col">
            <div class="header">
                <div>
                    <span style="font-weight:800; font-size:1.2rem; color:var(--primary);">MATH CBT</span>
                    <span id="viol-badge" style="background:#fee2e2; color:#b91c1c; font-size:0.75rem; padding:4px 8px; border-radius:4px; margin-left:10px; font-weight:700; display:none;">PELANGGARAN: 0</span>
                </div>
                <div style="display:flex; align-items:center; gap:15px;">
                    <div class="timer-box" id="timer">02:00:00</div>
                    <button class="mobile-toggle" onclick="toggleSidebar()">â˜°</button>
                </div>
            </div>

            <div class="content-scroll">
                <div id="q-container">
                    </div>
            </div>

            <div class="footer">
                <button class="btn-nav btn-prev" onclick="moveQ(-1)">Sebelumnya</button>
                <button class="btn-nav btn-ragu" id="btn-ragu" onclick="toggleRagu()">Ragu-ragu</button>
                <button class="btn-nav btn-next" onclick="moveQ(1)">Selanjutnya</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sb-header">Navigasi Soal</div>
            <div class="grid-wrapper">
                <div class="nav-grid" id="nav-grid"></div>
            </div>
            <div style="padding:20px; border-top:1px solid #e2e8f0;">
                <button class="btn-submit" onclick="finishExam()">KIRIM JAWABAN</button>
            </div>
        </div>
        <div onclick="toggleSidebar()" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:15; display:none;" id="overlay"></div>
    </div>

    <div id="modal-res">
        <div class="res-box">
            <h3 style="margin:0; color:#64748b; text-transform:uppercase; letter-spacing:1px; font-size:0.9rem;">Nilai Akhir Anda</h3>
            <div class="score-big" id="final-score">0</div>
            <div style="background:#f8fafc; padding:20px; border-radius:12px; margin-top:20px; text-align:left;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>Jawaban Benar</span><b style="color:var(--success)" id="out-ben">0</b>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>Jawaban Salah</span><b style="color:var(--danger)" id="out-sal">0</b>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>Pelanggaran</span><b style="color:var(--accent)" id="out-pel">0</b>
                </div>
            </div>
            <button class="btn-wa" onclick="sendWA()">Lapor ke Guru (WhatsApp)</button>
        </div>
    </div>

    <div id="warning">
        <div style="font-size:5rem;">ðŸš«</div>
        <h1>PERINGATAN!</h1>
        <p>Dilarang meninggalkan halaman ujian.<br>Aktivitas ini tercatat.</p>
        <button onclick="resumeExam()" style="background:white; color:#dc2626; padding:12px 30px; border:none; border-radius:50px; font-weight:bold; margin-top:20px; cursor:pointer;">KEMBALI KE SOAL</button>
    </div>

<script>
    // --- KONFIGURASI ---
    const TOTAL_SOAL = 100;
    const DURATION_SEC = 120 * 60; // 120 Menit
    
    // State
    let bankSoal = [];
    let currentIdx = 0;
    let timeLeft = DURATION_SEC;
    let timerInt;
    let violations = 0;
    let isSubmitting = false; // FLAG PENTING FIX BUG ANTI-CHEAT

    // --- DATABASE RANDOMIZER (BANYAK VARIASI) ---
    const N = ["Pak Budi", "Bu Ani", "Andi", "Siti", "Eko", "Rina", "Pak Haji", "Juragan Asep", "Kapten Joko", "Profesor Ein", "Nenek Ijah", "Mang Ujang", "Dokter Fani", "Bu Dewi", "Kang Dadang", "Sultan Rara"];
    const L = ["Gudang Pusat", "Laboratorium", "Pasar Induk", "Puncak Gunung", "Dasar Laut", "Koperasi Desa", "Bank Kota", "Pabrik Tekstil", "Kebun Teh", "Ruang Server"];
    const I = ["Beras", "Gula Pasir", "Minyak Goreng", "Tepung Terigu", "Semen", "Kain Sutra", "Tali Tambang", "Bensin", "Pakan Ternak"];

    // Utils
    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function fmt(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    
    // Renderer Pecahan
    function mx(v) {
        if(Number.isInteger(v)) return v;
        let s = v<0?"-":""; v=Math.abs(v);
        let w=Math.floor(v), d=v-w, f="";
        if(Math.abs(d-0.5)<0.01) f=`<span class="frac"><span class="top">1</span><span class="bot">2</span></span>`;
        else if(Math.abs(d-0.25)<0.01) f=`<span class="frac"><span class="top">1</span><span class="bot">4</span></span>`;
        else if(Math.abs(d-0.75)<0.01) f=`<span class="frac"><span class="top">3</span><span class="bot">4</span></span>`;
        else if(Math.abs(d-0.125)<0.01) f=`<span class="frac"><span class="top">1</span><span class="bot">8</span></span>`;
        else return v.toFixed(2);
        return w===0 ? `<span class="mixed">${s}${f}</span>` : `<span class="mixed">${s}${w}${f}</span>`;
    }

    // --- 100 LOGIKA SOAL BERBEDA (SCENARIO ENGINE) ---
    function generateSoal() {
        bankSoal = [];
        for(let i=1; i<=TOTAL_SOAL; i++) {
            let q = { id: i, txt: "", ans: 0, ops: [], user: null, ragu: false };
            let nm = pick(N), lc = pick(L), it = pick(I);

            // BILANGAN BULAT (1-50)
            if(i <= 50) {
                let type = (i % 10); // 10 Variasi
                if(type==0) { // Suhu
                    let s=-rand(10,30), n=rand(5,15), t=rand(10,25);
                    q.txt = `Di ${lc}, suhu awal <b>${s}Â°C</b>. Naik <b>${n}Â°C</b>, turun <b>${t}Â°C</b>. Akhir?`; q.ans = s+n-t;
                } else if(type==1) { // Uang
                    let s=rand(2,8)*100000, b=s+50000, in_=200000;
                    q.txt = `Saldo <b>Rp${fmt(s)}</b>. Debit <b>Rp${fmt(b)}</b> (minus). Setor <b>Rp${fmt(in_)}</b>. Akhir?`; q.ans = s-b+in_;
                } else if(type==2) { // Skor
                    let b=rand(30,40), s=rand(5,8), k=50-b-s;
                    q.txt = `Ujian 50 soal. Benar +4, Salah -2, Kosong -1. Benar <b>${b}</b>, Salah <b>${s}</b>. Skor?`; q.ans = (b*4)+(s*-2)+(k*-1);
                } else if(type==3) { // Kedalaman
                    let s=-rand(50,200), n=rand(20,40), t=rand(30,60);
                    q.txt = `Kapal di <b>${Math.abs(s)}m</b>. Naik <b>${n}m</b>, turun <b>${t}m</b>. Posisi?`; q.ans = s+n-t;
                } else if(type==4) { // Lift
                    let s=rand(1,10), n=rand(5,15), t=rand(3,8);
                    q.txt = `Lift lantai <b>${s}</b>. Naik <b>${n}</b>, turun <b>${t}</b>. Lantai?`; q.ans = s+n-t;
                } else if(type==5) { // Parkir
                    let s=rand(50,100), m=rand(20,40), k=rand(30,50);
                    q.txt = `Parkiran ada <b>${s}</b> mobil. Masuk <b>${m}</b>, keluar <b>${k}</b>. Total?`; q.ans = s+m-k;
                } else if(type==6) { // Poin Game
                    let s=200, k1=rand(20,50), k2=rand(10,30);
                    q.txt = `Poin awal <b>${s}</b>. Kena denda <b>${k1}</b> dan <b>${k2}</b>. Sisa?`; q.ans = s-k1-k2;
                } else if(type==7) { // Suhu Kota
                    let a=rand(-10,10), b=rand(5,15);
                    q.txt = `Kota A <b>${a}Â°C</b>. Kota B <b>${b}Â°C</b> lebih dingin. Jumlah suhu A+B?`; q.ans = a+(a-b);
                } else if(type==8) { // Pesawat
                    let h=rand(5000,8000), t=rand(1000,2000), n=rand(500,1000);
                    q.txt = `Pesawat di <b>${h} kaki</b>. Turun <b>${t}</b>, naik <b>${n}</b>. Posisi?`; q.ans = h-t+n;
                } else { // Hutang
                    let h=rand(5,10)*10000, b=rand(2,4)*10000;
                    q.txt = `Hutang <b>Rp${fmt(h)}</b>. Bayar <b>Rp${fmt(b)}</b>. Sisa hutang (negatif)?`; q.ans = -(h)+b;
                }
            } 
            // PECAHAN (51-100)
            else {
                let type = (i % 10);
                if(type==0) { // Stok
                    let s=rand(10,20)+0.5, m=rand(5,10)+0.25, k=rand(2,8)+0.75;
                    q.txt = `Stok <b>${mx(s)}</b> ton. Masuk <b>${mx(m)}</b>. Keluar <b>${mx(k)}</b>. Sisa?`; q.ans = s+m-k;
                } else if(type==1) { // Warisan
                    let l=2400; q.txt = `Tanah <b>${l} mÂ²</b>. 1/3 wakaf. <b>Dari sisa</b>, 1/4 anak. Luas anak?`; q.ans = (l-(l/3))/4;
                } else if(type==2) { // Kali
                    let qy=rand(10,20), u=1.25; q.txt = `Pesanan <b>${qy}</b> baju. Satu baju <b>${mx(u)} m</b> kain. Total?`; q.ans = qy*u;
                } else if(type==3) { // Bagi
                    let t=rand(10,30)+0.5, w=5; q.txt = `Gula <b>${mx(t)} kg</b> dibagi ke <b>${w}</b> kantong. Berat/kantong?`; q.ans = t/w;
                } else if(type==4) { // Tali
                    let p=rand(20,40)+0.75, p1=rand(5,10)+0.5, p2=rand(2,8)+0.25; q.txt = `Tali <b>${mx(p)} m</b>. Potong <b>${mx(p1)}</b> dan <b>${mx(p2)}</b>. Sisa?`; q.ans = p-p1-p2;
                } else if(type==5) { // Bensin
                    let f=rand(30,50)+0.5, j=120, r=10; q.txt = `Bensin <b>${mx(f)} L</b>. Jarak <b>${j} km</b> (1L/${r}km). Sisa?`; q.ans = f-(j/r);
                } else if(type==6) { // Panen
                    let p=rand(100,500); q.txt = `Panen <b>${p} kg</b>. Jual 1/2, busuk 1/4 total. Sisa?`; q.ans = p-(p*0.5)-(p*0.25);
                } else if(type==7) { // Cat
                    let b=rand(2,5), k=2.5; q.txt = `Butuh <b>${b} kaleng</b>. Satu kaleng <b>${mx(k)} liter</b>. Total?`; q.ans = b*k;
                } else if(type==8) { // Botol
                    let v=rand(5,10), b=0.25; q.txt = `Air <b>${v} liter</b> dituang ke botol <b>${mx(b)} liter</b>. Butuh botol?`; q.ans = v/b;
                } else { // Resep
                    let t=rand(1,3)+0.5, g=0.25, m=0.25; q.txt = `Resep: Tepung <b>${mx(t)}</b>, Gula <b>${mx(g)}</b>, Mentega <b>${mx(m)}</b>. Total?`; q.ans = t+g+m;
                }
            }

            // Opsi Unik
            let set = new Set([q.ans]);
            while(set.size < 5) {
                let diff = (Math.random()*6)-3;
                if(i>50) diff = Math.round(diff*4)/4; else diff = Math.round(diff);
                if(diff==0) diff=1;
                let f = q.ans + diff;
                if(Math.abs(f-q.ans)>0.001) set.add(f);
            }
            q.ops = Array.from(set).sort(()=>Math.random()-0.5);
            bankSoal.push(q);
        }
    }

    // --- RENDER FUNCTIONS ---
    function renderNav() {
        const g = document.getElementById('nav-grid');
        g.innerHTML = '';
        bankSoal.forEach((q, i) => {
            let el = document.createElement('div');
            el.className = 'nav-item';
            el.id = `nav-${i}`;
            el.innerText = i+1;
            el.onclick = () => loadQ(i);
            g.appendChild(el);
        });
        updateNavState();
    }

    function updateNavState() {
        bankSoal.forEach((q, i) => {
            let el = document.getElementById(`nav-${i}`);
            el.className = 'nav-item';
            if(i === currentIdx) el.classList.add('active');
            if(q.ragu) el.classList.add('ragu');
            else if(q.user !== null) el.classList.add('done');
        });
        
        let btnRagu = document.getElementById('btn-ragu');
        if(bankSoal[currentIdx].ragu) btnRagu.classList.add('active');
        else btnRagu.classList.remove('active');
    }

    function loadQ(idx) {
        currentIdx = idx;
        const q = bankSoal[idx];
        const con = document.getElementById('q-container');
        
        let label = q.id<=50 ? "BILANGAN BULAT" : "PECAHAN CAMPURAN";
        
        con.innerHTML = `
            <div class="q-card">
                <div class="q-meta">
                    <span>Soal No. ${q.id}</span>
                    <span>${label}</span>
                </div>
                <div class="q-text">${q.txt}</div>
                <div class="opt-list">
                    ${q.ops.map((o, i) => `
                        <div class="opt-btn ${q.user===o?'selected':''}" onclick="answer(${o})">
                            <div class="opt-idx">${['A','B','C','D','E'][i]}</div>
                            <div style="font-size:1.1rem; font-weight:500;">${q.id>50?mx(o):o}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        updateNavState();
        
        // Auto scroll sidebar
        document.getElementById(`nav-${idx}`).scrollIntoView({behavior:"smooth", block:"nearest"});
    }

    function answer(val) {
        bankSoal[currentIdx].user = val;
        loadQ(currentIdx);
    }

    function toggleRagu() {
        bankSoal[currentIdx].ragu = !bankSoal[currentIdx].ragu;
        updateNavState();
    }

    function moveQ(step) {
        let n = currentIdx + step;
        if(n >= 0 && n < TOTAL_SOAL) loadQ(n);
    }

    function toggleSidebar() {
        let sb = document.getElementById('sidebar');
        let ov = document.getElementById('overlay');
        if(sb.classList.contains('open')) {
            sb.classList.remove('open');
            ov.style.display = 'none';
        } else {
            sb.classList.add('open');
            ov.style.display = 'block';
        }
    }

    // --- SYSTEM LOGIC ---
    function startExam() {
        let n = document.getElementById('nama').value;
        let k = document.getElementById('kelas').value;
        if(!n || !k) { alert("Lengkapi Identitas!"); return; }

        if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen().catch(()=>{});
        
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        
        generateSoal();
        renderNav();
        loadQ(0);
        
        // FIX: Start Anti-Cheat
        document.addEventListener("visibilitychange", checkCheat);
        window.onblur = checkCheat;

        // FIX: Timer
        timerInt = setInterval(() => {
            if(timeLeft <= 0) { finishExam(true); return; }
            timeLeft--;
            let h = Math.floor(timeLeft/3600);
            let m = Math.floor((timeLeft%3600)/60);
            let s = timeLeft%60;
            document.getElementById('timer').innerText = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
        }, 1000);
    }

    // FIX ANTI-CHEAT: Cek flag isSubmitting
    function checkCheat() {
        if(document.hidden && !isSubmitting && document.getElementById('app').style.display === 'block') {
            violations++;
            document.getElementById('viol-badge').innerText = `PELANGGARAN: ${violations}`;
            document.getElementById('viol-badge').style.display = 'inline-block';
            document.getElementById('warning').style.display = 'flex';
        }
    }

    function resumeExam() {
        document.getElementById('warning').style.display = 'none';
        if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen().catch(()=>{});
    }

    function finishExam(force=false) {
        if(!force && !confirm("Yakin kirim jawaban?")) return;
        
        isSubmitting = true; // MATIKAN DETEKSI CHEAT
        clearInterval(timerInt);

        let b=0, s=0;
        bankSoal.forEach(q => { if(Math.abs(q.user-q.ans)<0.001) b++; else s++; });

        document.getElementById('final-score').innerText = b;
        document.getElementById('out-ben').innerText = b;
        document.getElementById('out-sal').innerText = s;
        document.getElementById('out-pel').innerText = violations;
        
        document.getElementById('modal-res').style.display = 'flex';
        if(document.fullscreenElement) document.exitFullscreen();
    }

    function sendWA() {
        let n=document.getElementById('nama').value, k=document.getElementById('kelas').value;
        let sc=document.getElementById('final-score').innerText;
        window.open(`https://wa.me/6285890554900?text=*HASIL UJIAN*%0ANama: ${n}%0AKelas: ${k}%0ANilai: ${sc}%0APelanggaran: ${violations}`, '_blank');
    }

    document.addEventListener('contextmenu', e=>e.preventDefault());

</script>
</body>
</html>